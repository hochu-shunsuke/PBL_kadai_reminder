<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            margin: 15px;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h4>WebClass 認証情報登録</h4>
        <p class="text-muted">学籍番号とパスワードを入力してください。</p>
        <div id="alert-message" class="alert alert-danger d-none" role="alert"></div>
        <form onsubmit="return handleFormSubmit(this)">
            <div class="mb-3">
                <label for="userid" class="form-label">学籍番号 (User ID)</label>
                <input type="text" class="form-control" id="userid" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">パスワード (Password)</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button id="save-btn" type="submit" class="btn btn-primary w-100">資格情報を登録</button>
        </form>
    </div>
    <script>
        const saveButton = document.getElementById('save-btn');
        const alertMessage = document.getElementById('alert-message');
        function handleFormSubmit(form) {
            saveButton.disabled = true;
            saveButton.innerHTML = '<span class="spinner-border spinner-border-sm"></span> 保存中...';
            alertMessage.classList.add('d-none');
            google.script.run
                .withSuccessHandler(() => {
                    alertMessage.className = 'alert alert-success';
                    alertMessage.textContent = '✅ 保存しました。';
                    setTimeout(() => google.script.host.close(), 1000);
                })
                .withFailureHandler((e) => {
                    alertMessage.className = 'alert alert-danger';
                    alertMessage.textContent = 'エラー: ' + e.message;
                    saveButton.disabled = false;
                    saveButton.innerHTML = '資格情報を登録';
                })
                // Utils.gs の setCredentials を呼び出し
                .setCredentials(form.userid.value, form.password.value);
            return false;
        }
    </script>
</body>

</html>